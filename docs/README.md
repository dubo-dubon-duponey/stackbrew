# Stackbrew Packages

### ecs

#### Task

##### Fields

| FIELD            | SPEC                                                                                                                                                                                                                                                                            | DOC               |
| -------------    |:-------------:                                                                                                                                                                                                                                                                  |:-------------:    |
|*cpu*             |``*256 \| uint``                                                                                                                                                                                                                                                                 |N/A                |
|*memory*          |``*512 \| uint``                                                                                                                                                                                                                                                                 |N/A                |
|*networkMode*     |``*"bridge" \| string``                                                                                                                                                                                                                                                          |N/A                |
|*containers*      |``[Container, ...]``                                                                                                                                                                                                                                                             |N/A                |
|*resources*       |``{ ECSTaskDefinition: { Type: "AWS::ECS::TaskDefinition" Properties: { Cpu: strconv.FormatUint(cpu, 10) Memory: strconv.FormatUint(memory, 10) if (roleArn & string) != _\|_ { ExecutionRoleArn: roleArn } NetworkMode: networkMode ContainerDefinitions: containers } } }``    |N/A                |

#### Container

##### Fields

| FIELD            | SPEC                | DOC               |
| -------------    |:-------------:      |:-------------:    |
|*Command*         |``[string, ...]``    |N/A                |
|*Name*            |``string``           |N/A                |
|*Image*           |``string``           |N/A                |

#### Service

##### Fields

| FIELD              | SPEC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | DOC                                           |
| -------------      |:-------------:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |:-------------:                                |
|*resources*         |``{ ECSListenerRule: { Type: "AWS::ElasticLoadBalancingV2::ListenerRule" Properties: { ListenerArn: elbListenerArn Priority: 100 Conditions: [{ Field: "host-header" Values: [hostName] }] Actions: [{ Type: "forward" TargetGroupArn: Ref: "ECSTargetGroup" }] } } ECSTargetGroup: { Type: "AWS::ElasticLoadBalancingV2::TargetGroup" Properties: { VpcId: vpcID Port: 80 Protocol: "HTTP" } } ECSService: { Type: "AWS::ECS::Service" Properties: { Cluster: cluster DesiredCount: desiredCount LaunchType: launchType LoadBalancers: [{ TargetGroupArn: Ref: "ECSTargetGroup" ContainerName: containerName ContainerPort: containerPort }] ServiceName: serviceName TaskDefinition: Ref: "ECSTaskDefinition" } DependsOn: "ECSListenerRule" } }``    |N/A                                            |
|*cluster*           |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |ECS cluster name or ARN                        |
|*containerPort*     |``int & \>=0``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |Container port                                 |
|*containerName*     |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |Container name                                 |
|*launchType*        |``"FARGATE" \| "EC2"``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |Service launch type                            |
|*vpcID*             |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |VPC id of the cluster                          |
|*elbListenerArn*    |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |ARN of the ELB listener                        |
|*hostName*          |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |Hostname of the publicly accessible service    |
|*serviceName*       |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |Name of the service                            |

#### SimpleECSApp

SimpleECSApp is a simplified interface for ECS

##### Fields

| FIELD              | SPEC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | DOC               |
| -------------      |:-------------:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |:-------------:    |
|*config*            |``aws.Config``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |N/A                |
|*resources*         |``C{ECSTaskDefinition: C{Type: "AWS::ECS::TaskDefinition", Properties: C{Cpu: FormatUint (cpu,10), Memory: FormatUint (memory,10), NetworkMode: networkMode, ContainerDefinitions: containers if ((roleArn & string) != _\|_(from source)) yield C{ExecutionRoleArn: roleArn}}}, ECSListenerRule: C{Type: "AWS::ElasticLoadBalancingV2::ListenerRule", Properties: C{ListenerArn: elbListenerArn, Priority: 100, Conditions: [C{Field: "host-header", Values: [hostName]}], Actions: [C{Type: "forward", TargetGroupArn: C{Ref: "ECSTargetGroup"}}]}}, ECSTargetGroup: C{Type: "AWS::ElasticLoadBalancingV2::TargetGroup", Properties: C{Protocol: "HTTP", VpcId: vpcID, Port: 80}}, ECSService: C{Type: "AWS::ECS::Service", Properties: C{Cluster: cluster, DesiredCount: desiredCount, LaunchType: launchType, LoadBalancers: [C{ContainerPort: containerPort, TargetGroupArn: C{Ref: "ECSTargetGroup"}, ContainerName: containerName}], ServiceName: serviceName, TaskDefinition: C{Ref: "ECSTaskDefinition"}}, DependsOn: "ECSListenerRule"}}``    |N/A                |
|*containerPort*     |``*80 \| uint``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |N/A                |
|*hostname*          |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |N/A                |
|*containerImage*    |``string``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |N/A                |
|*infra*             |``{ cluster: string vpcID: string elbListenerArn: string }``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |N/A                |
|*subDomain*         |``strings.Split(hostname, ".")[0]``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |N/A                |
|*out*               |``cfn.stackOutput``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |N/A                |
|*cfn*               |``cloudformation.Stack & { config: inputConfig source: json.Marshal({ AWSTemplateFormatVersion: "2010-09-09" Description: "ECS App deployed with Blocklayer" Resources: resources }) stackName: "bl-ecs-\(subDomain)" }``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |N/A                |
